name: Build DebugProbe UF2

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout debugprobe repo
    - name: Checkout debugprobe
      uses: actions/checkout@v3
      with:
        repository: raspberrypi/debugprobe
        submodules: recursive  # ensures pico-sdk is included

    # 2. Install dependencies
    - name: Install ARM GCC and build tools
      run: |
        sudo apt update
        sudo apt install -y gcc-arm-none-eabi cmake ninja-build build-essential git

    # 3. Build debugprobe firmware
    - name: Build debugprobe_on_pico.uf2
      run: |
        mkdir -p build
        cd build
        cmake -DDEBUG_ON_PICO=ON -G Ninja ..
        ninja

    # 4. Upload UF2 as artifact
    - name: Upload UF2
      uses: actions/upload-artifact@v4
      with:
        name: debugprobe-uf2
        path: build/*.uf2
